# Docker Image with [BitTorrent Sync](https://www.getsync.com/)

## Base Docker Image

- [ubuntu:16.04](https://registry.hub.docker.com/_/ubuntu/)

## Requirements:

- [Docker](http://www.docker.com/)

## Build

Build the container with the following command:

    docker build -t="emqz/btsync" github.com/emq/docker-btsync

Build the container locally with the following commands:

    git clone git@github.com:emq/docker-btsync.git
    cd docker-btsync
    docker build -t="emqz/btsync" .

Or download [automated build](https://registry.hub.docker.com/u/emqz/btsync/) from public [Docker Hub Registry](https://registry.hub.docker.com/):

    docker pull emqz/btsync

## Usage

### Step 1 - create the environment

Start server:

    docker run -d --name=btsync-server --hostname=server emqz/btsync

Check the secret:

    $ docker logs btsync-server
    Starting btsync with secret: APJUH5CHUQYSU3BBRG7KZ4HVOYAWB4PAW
    By using this application, you agree to our Privacy Policy, Terms of Use and End User License Agreement.
    http://www.bittorrent.com/legal/privacy
    http://www.bittorrent.com/legal/terms-of-use
    http://www.bittorrent.com/legal/eula

    [20150629 16:16:12.117] total physical memory 536870912 max disk cache 2097152
    [20150629 16:16:12.117] My PeerID: 103ABB47EB745E4310E55186BC703558F4913D22

Start client:

    docker run -d --name=btsync-client --hostname=client emqz/btsync APJUH5CHUQYSU3BBRG7KZ4HVOYAWB4PAW

Notice that we pass to the client a key (`APJUH5CHUQYSU3BBRG7KZ4HVOYAWB4PAW`) which was generated by the server.

### Step 2 - test the file sync

Login to the server and watch the `/data` directory:

    $ docker exec -it btsync-server bash 
    # TERM=xterm watch -n1 -c 'ls -al /data'

Now login to the `btsync-client` and create a sample file:

    $ docker exec -it btsync-client /bin/bash
    # echo test > /data/test.out

As soon as the file is created the `watch` command should return something like this:

    Every 1.0s: ls -al /data  Mon Jun 29 16:27:03 2015

    total 16
    drwxr-xr-x  3 root root 4096 Jun 29 16:26 .
    drwxr-xr-x 47 root root 4096 Jun 29 16:23 ..
    drwxr-xr-x  3 root root 4096 Jun 29 16:16 .sync
    -rw-r--r--  1 root root    5 Jun 29 16:26 test.out
